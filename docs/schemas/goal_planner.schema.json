{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://dyocense.dev/schemas/goal_planner.schema.json",
  "title": "Goal Planner Schemas",
  "description": "JSON Schemas for GoalRequest, PlanDelta, and GoalPlan",
  "type": "object",
  "definitions": {
    "BusinessContext": {
      "type": "object",
      "properties": {
        "business_unit_id": { "type": "string" },
        "markets": { "type": "array", "items": { "type": "string" } },
        "products": { "type": "array", "items": { "type": "string" } }
      },
      "additionalProperties": false
    },
    "ObjectiveWeights": {
      "type": "object",
      "properties": {
        "cost": { "type": "number", "minimum": 0, "maximum": 1 },
        "revenue": { "type": "number", "minimum": 0, "maximum": 1 },
        "service_level": { "type": "number", "minimum": 0, "maximum": 1 },
        "carbon": { "type": "number", "minimum": 0, "maximum": 1 }
      },
      "additionalProperties": false
    },
    "Constraint": {
      "type": "object",
      "required": ["name", "type", "value"],
      "properties": {
        "name": { "type": "string" },
        "type": { "type": "string", "enum": ["bound", "logical", "budget", "policy"] },
        "value": {}
      },
      "additionalProperties": false
    },
    "GoalRequest": {
      "type": "object",
      "required": ["tenant_id", "project_id", "goal_text", "horizon"],
      "properties": {
        "tenant_id": { "type": "string" },
        "project_id": { "type": "string" },
        "business_context": { "$ref": "#/definitions/BusinessContext" },
        "goal_text": { "type": "string", "minLength": 1 },
        "horizon": {
          "oneOf": [
            { "type": "object", "required": ["unit", "value"], "properties": { "unit": { "type": "string", "enum": ["weeks", "months"] }, "value": { "type": "integer", "minimum": 1, "maximum": 60 } }, "additionalProperties": false },
            { "type": "object", "required": ["start_date", "end_date"], "properties": { "start_date": { "type": "string", "format": "date" }, "end_date": { "type": "string", "format": "date" } }, "additionalProperties": false }
          ]
        },
        "objectives": { "$ref": "#/definitions/ObjectiveWeights" },
        "policies": { "type": "array", "items": { "type": "string" } },
        "constraints": { "type": "array", "items": { "$ref": "#/definitions/Constraint" } },
        "data_inputs": {
          "type": "object",
          "properties": {
            "inventory_dataset_id": { "type": "string" },
            "demand_dataset_id": { "type": "string" },
            "capacity_dataset_id": { "type": "string" }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "PlanAction": {
      "type": "object",
      "required": ["id", "type", "entity"],
      "properties": {
        "id": { "type": "string" },
        "type": { "type": "string", "enum": ["stock_rebalance", "price_change", "procure", "transfer", "capacity_shift", "other"] },
        "entity": { "type": "string" },
        "delta": {},
        "rationale": { "type": "string" }
      },
      "additionalProperties": false
    },
    "KPIs": {
      "type": "object",
      "properties": {
        "cost_total": { "type": "number" },
        "revenue_total": { "type": "number" },
        "service_level": { "type": "number" },
        "carbon": { "type": "number" }
      },
      "additionalProperties": false
    },
    "GoalPlan": {
      "type": "object",
      "required": ["id", "summary", "kpis"],
      "properties": {
        "id": { "type": "string" },
        "summary": { "type": "string" },
        "version": { "type": "string" },
        "kpis": {
          "type": "object",
          "required": ["baseline", "projected"],
          "properties": {
            "baseline": { "$ref": "#/definitions/KPIs" },
            "projected": { "$ref": "#/definitions/KPIs" }
          },
          "additionalProperties": false
        },
        "actions": { "type": "array", "items": { "$ref": "#/definitions/PlanAction" } },
        "schedule": { "type": "array", "items": { "type": "object" } },
        "risks": { "type": "array", "items": { "type": "string" } },
        "assumptions": { "type": "array", "items": { "type": "string" } }
      },
      "additionalProperties": false
    },
    "PlanDelta": {
      "type": "object",
      "properties": {
        "adjust_horizon": { "type": "object", "properties": { "unit": { "type": "string", "enum": ["weeks", "months"] }, "value": { "type": "integer", "minimum": 1, "maximum": 60 } }, "additionalProperties": false },
        "change_objective_weights": { "$ref": "#/definitions/ObjectiveWeights" },
        "add_constraints": { "type": "array", "items": { "$ref": "#/definitions/Constraint" } },
        "remove_constraint_names": { "type": "array", "items": { "type": "string" } },
        "relax_constraints": { "type": "array", "items": { "$ref": "#/definitions/Constraint" } },
        "lock_action_ids": { "type": "array", "items": { "type": "string" } },
        "scenario_tags": { "type": "array", "items": { "type": "string" } }
      },
      "additionalProperties": false
    }
  }
}
